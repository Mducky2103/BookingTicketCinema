@page
@model BookingTicketCinema.WebApp.Pages.Booking.SeatMapModel
@{
    ViewData["Title"] = "Chọn Ghế";
}

<link rel="stylesheet" href="~/css/site.seatmap.css" asp-append-version="true" />

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}
else
{
    <div class="text-center mb-4">
        <h1>@ViewData["Title"]</h1>
        <h4>@Model.Movie.Title</h4>
        <p class="lead">
            @Model.Showtime.StartTime.ToString("dd/MM/yyyy") |
            <strong>@Model.Showtime.StartTime.ToString("HH:mm")</strong> |
            @Model.Room.Name
        </p>
    </div>

    <div class="seat-map-container mx-auto">
        <div class="screen mb-4">MÀN HÌNH</div>

        @foreach (var row in Model.SeatsByRow)
        {
            <div class="seat-row">
                <span class="seat-label">@row.Key</span> @foreach (var seat in row.Value)
                {
                    // KIỂM TRA GHẾ
                    bool isOccupied = Model.TakenSeatIds.Contains(seat.SeatId);

                    // Xác định CSS cho ghế
                    string seatClass = "seat";
                    if (isOccupied)
                    {
                        seatClass += " seat-occupied";
                    }
                    else if (seat.SeatType == 1) // VIP
                    {
                        seatClass += " seat-vip";
                    }
                    else if (seat.SeatType == 2) // Đôi
                    {
                        seatClass += " seat-double";
                    }
                    else // Thường
                    {
                        seatClass += " seat-available";
                    }

                    <div class="@seatClass" data-seat-id="@seat.SeatId" data-seat-name="@seat.SeatNumber" data-seat-type="@seat.SeatType"></div>
                }
            </div>
        }
    </div>

    <div class="d-flex justify-content-center mt-4">
        <div class="d-flex align-items-center me-3">
            <div class="seat seat-available me-2" style="cursor: default;"></div>
            <span>Ghế thường</span>
        </div>
        <div class="d-flex align-items-center me-3">
            <div class="seat seat-vip me-2" style="cursor: default;"></div>
            <span>Ghế VIP</span>
        </div>
        <div class="d-flex align-items-center me-3">
            <div class="seat seat-selected me-2" style="cursor: default;"></div>
            <span>Đang chọn</span>
        </div>
        <div class="d-flex align-items-center">
            <div class="seat seat-occupied me-2" style="cursor: default;"></div>
            <span>Đã bán</span>
        </div>
    </div>


    <div class="booking-summary-bar shadow-lg">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <span class="text-muted d-block">Bạn đang chọn:</span>
                <strong id="selected-seats" class="fs-5">Chưa chọn ghế</strong>
            </div>
            <div>
                <span class="text-muted d-block">Tổng cộng:</span>
                <strong id="total-price" class="fs-5 text-primary">0đ</strong>
            </div>
            <a id="btn-checkout" asp-page="/Booking/Checkout" asp-route-showtimeId="@Model.ShowtimeId" class="btn btn-primary btn-lg disabled">
                Tiếp tục <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>
}

@section Scripts {
    <script src="~/js/seat-selection.js" asp-append-version="true"></script>
}